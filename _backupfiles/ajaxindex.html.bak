<style>
    .opbutton {
        border-color: #009688;
        color: #333;
        margin-right: 10px;
        margin-bottom: 10px;
        opacity: .8;
        background: 0 0;
        height: 32px;
        line-height: 10px;
        border: 1px solid black;
        padding: 0 18px;
        white-space: nowrap;
        text-align: center;
        font-size: 14px;
        border-radius: 2px;
        cursor: pointer;
        outline: 0;
        transform: translateY(-50%);
        top: 50%;
        position: relative
    }
    .opul {
        background: #f0f0f0;
    }
    .opul li {
        border-bottom: 1px solid #fff;
    }
    .ops {
        position: relative;
        overflow: visible;
    }
</style>
<div id="flexigrid" cellpadding="0" cellspacing="0" border="0">
    <table>
        <tbody>
        <volist name="userList" id="list">
            <tr data-id="{$list['user_id']}">
                <td class="sign">
                    <div style="width: 24px;"><i class="ico-check"></i></div>
                </td>
                <td align="left" class="">
                    <div style="text-align: center; width: 50px;">{$list.user_id}</div>
                </td>
                <td align="left" class="">
                    <div style="text-align: center; width: 120px;color: {$list.is_lock ? 'red' : ''};">{$list.nickname}({:get_pin($list.user_id)})</div>
                </td>
                <td align="left" class="">
                    <div style="text-align: center; width: 50px;">{$list.grade}</div>
                </td>
                <td align="left" class="">
                    <div style="text-align: center; width: 50px;">{$list.stars_grade}</div>
                </td>
                <td align="left" class="">
                    <div style="text-align: center; width: 250px;" title="{$list.mobile}">{$list.mobile}({:getUserName($list['user_id'])})<if condition="$list[is_authentication] eq 2">(已认证)</if>
                        <if condition="$list.is_distribution eq 1">
                            (推)
                        <elseif condition="$list.is_distribution eq 2"/>
                            (服)
                        </if>
                        <if condition="$list.is_attract_investment eq 1">
                            (招)
                        </if>
                        <if condition="($list['mobile_validated'] eq 0) AND empty($list['mobile'])">
                            (未验证)
                        </if>
                    </div>
                </td>
                <td align="left" class="">
                    <div style="text-align: center; width: 50px;">{$first_leader[$list[user_id]]['count']|default="0"}</div>
                </td>
                <td align="left" class="">
                    <div style="text-align: center; width: 50px;">{$second_leader[$list[user_id]]['count']|default="0"}</div>
                </td>
                <td align="left" class="">
                    <div style="text-align: center; width: 50px;">{$third_leader[$list[user_id]]['count']|default="0"}</div>
                </td>
                <!--<td align="left" class="">
                    <div style="text-align: center; width: 50px;">{$level[$list[level]]}</div>
                </td>-->
                <td align="left" class="">
                    <div style="text-align: center; width: 150px;"><a href="javascript:;" onclick="shangji({$list['first_leader']})">{:getmobile($list['first_leader'])}({:getUserName($list['first_leader'])})</a></div>
                </td>
                <!--<td align="left" class="">
                    <div style="text-align: center; width: 100px;">{$list.total_amount}</div>
                </td>-->
                <!--<td align="left" class="">
                    <div style="text-align: center; width: 120px;">{$list.email}
                        <if condition="($list['email_validated'] eq 0) AND empty($list['email'])">
                            (未验证)
                        </if>
                    </div>
                </td>-->
                <td align="left" class="">
                    <div style="text-align: center; width: 150px;">{:team_liveness($list['user_id'])}({$list['liveness']})</div>
                </td>
                <td align="left" class="">
                    <div style="text-align: center; width: 50px;">{:team_count($list['user_id'])}</div>
                </td>
                <td align="left" class="">
                    <div style="text-align: center; width: 50px;">{$list.exponent}</div>
                </td>
                <td align="left" class="">
                    <div style="text-align: center; width: 50px;">{$list.user_money}</div>
                </td>
                <td align="left" class="">
                    <div style="text-align: center; width: 50px;">{$list.pay_points}</div>
                </td>
                <td align="left" class="">
                    <div style="text-align: center; width: 140px;">{$list.reg_time|date='Y-m-d H:i',###}</div>
                </td>
                <td align="left" class="">
                    <div style="text-align: center; width: 140px;">{$list.last_login|date='Y-m-d H:i:s',###}</div>
                </td>
                <td align="left" class="">
                    <div style="text-align: center; width: 140px;">{$list.sign_time|date='Y-m-d H:i:s',###}</div>
                </td>
                <td align="center" class="headel">
                    <div style="text-align: center;">
                        <button  class="opbutton">操作列表</button>
                    </div>

                    <div style="text-align: center;position: relative;overflow: visible;display: none;z-index:9;" class="ops">
                        <ul class="opul">
                            <!--<a class="btn blue" href="{:U('Admin/user/detail',array('id'=>$list['user_id']))}"><i class="fa fa-pencil-square-o"></i>详情</a>-->
                            <li><a data-id="{$list.user_id}" class="btn blue lock" href="javascript:;" style="{$list.is_lock ? 'color: red' : ''}"><i class="fa {$list.is_lock ? 'fa-unlock' : 'fa-lock'}"></i>{$list.is_lock ? '解冻' : '冻结'}</a></li>
                            <li><a class="btn blue" href="{:U('Admin/user/user_distribution',array('id'=>$list['user_id']))}"><i class="fa fa-level-up"></i>升级推客</a></li>
                            <li><a class="btn blue" href="{:U('Admin/user/user_edit',array('id'=>$list['user_id'],'first_leader'=>$list['first_leader']))}"><i class="fa fa-edit"></i>推荐人编辑</a></li>
                            <li><a class="btn blue" href="{:U('Admin/user/user_modify',array('id'=>$list['user_id']))}"><i class="fa fa-edit"></i>用户信息修改</a></li>
                            <if condition="$admin_id eq 1">
                                <li><a class="btn blue" href="{:U('Admin/user/account_log',array('id'=>$list['user_id']))}"><i class="fa fa-money"></i>用户资金</a></li>
                            </if>
                            <li><a class="btn blue" href="{:U('Admin/user/address',array('id'=>$list['user_id']))}"><i class="fa fa-steam"></i>收货地址</a></li>
                            <li><a class="btn blue" href="{:U('/Admin/User/assets',array('id'=>$list['user_id']))}" target="_blank"><i class="fa fa-eye"></i>个人中心</a></li>
                        </ul>
                    </div>
                </td>
            </tr>
        </volist>
        </tbody>
    </table>
</div>
<!--分页位置-->
{$page}
<script>
    $(document).on('click', '.opbutton', function () {
        console.log($(this).parent().next().css('display'))
        if ('none' == $(this).parent().next().css('display')){
            $(this).parent().next().css('display', 'block')
        } else {
            <!--$(this).parent().next().css('display', 'none')-->
        }
    })
    $('html:not(".opbutton")').on('click', function() {
        $('.ops').css('display', 'none')
    })
    $(".pagination  a").click(function(){
        var page = $(this).data('p');
        ajax_get_table('search-form2',page);
    });
    $(document).ready(function(){
        // 表格行点击选中切换
        $('#flexigrid >table>tbody>tr').click(function(){
            $(this).toggleClass('trSelected');
        });
        $('#user_count').empty().html("{$pager->totalRows}");
    });

    $(document).on('click', '.lock', function () {
        let id = $(this).attr('data-id')
        layer.confirm('确认操作？', {
            btn: ['确定', '取消'] //按钮
        }, function () {
            let url = '/admin/user/user_lock'
            $.ajax({
                type: 'post',
                url: url ,
                data: {id : id},
                dataType: 'json',
                success: function (data) {
                    layer.closeAll();
                    layer.msg(data.msg, {icon: 1});
                    ajax_get_table('search-form2',1)
                }
            })
        }, function () {
        });
    })

    function delfun(obj) {
        // 删除按钮
        layer.confirm('确认删除？', {
            btn: ['确定', '取消'] //按钮
        }, function () {
            $.ajax({
                type: 'post',
                url: $(obj).attr('data-url'),
                data: {id : $(obj).attr('data-id')},
                dataType: 'json',
                success: function (data) {
                    layer.closeAll();
                    if (data.status == 1) {
                        $(obj).parent().parent().parent().remove();
                    } else {
                        layer.alert(data.msg, {icon: 2});
                    }
                }
            })
        }, function () {
        });
    }
</script>
